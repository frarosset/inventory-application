<%_ const postUrl = locals.edit ? `/ingredients/${data.id}/edit` : "/ingredients/new" _%>
<form action=<%= postUrl %> method="POST">
  <%- include("formValidationErrors.ejs") _%>
  <fieldset>
    <%- include("input.ejs",{type: "text", name: "name", label: "Name", maxlength: process.env.NAME_MAX_LENGTH, required: true,  pattern: process.env.NAME_REGEX, title: process.env.NAME_REGEX_MSG}) _%>
    <%_ 
        const dd = process.env.PRICE_DECIMAL_DIGITS;
        const step = Number(`1e-${dd}`).toFixed(dd);
        const maxPrice = parseFloat(process.env.PRICE_MAX);
        const maxStock = parseInt(process.env.STOCK_MAX);
      _%>
    <%- include("input.ejs",{type: "number", name: "price", label: `Price [${process.env.CURRENCY}]`, min: 0, max: maxPrice, step, required: true}) _%>
    <%- include("input.ejs",{type: "number", name: "stock", label: "Stock", min: 0, max: maxStock, step: 1, required: true}) _%>
    <%- include("textarea.ejs",{name: "notes", label: "Notes", maxlength: process.env.NOTES_MAX_LENGTH, pattern: process.env.NOTES_REGEX, title: process.env.NOTES_REGEX_MSG}) _%>
  </fieldset>
  <fieldset>
    <legend>Categories Rules</legend>
    <p>
      Select the categories that are
      <span class="enforcing" title="These categories are automatically added when this ingredient is used (unless incompatible)">enforced</span>
      by this ingredient or
      <span class="incompatible" title="These categories are automatically excluded this when this ingredient is used">incompatible</span>
      with it.
    </p>
    <%- include("multiStateCheckboxInputList.ejs", {list: categories, states: ["none","enforcedCategories","incompatibleCategories"]}) _%>
  </fieldset>
  <fieldset>
    <legend>Add to these Pizzas</legend>
    <%- include("protectedCheckboxInputList.ejs", {name: "pizzas", list: pizzas, protectedValues: protectedPizzas, prevProtectedSelectedValues: locals.prevProtectedPizzas}) _%>
  </fieldset>
  <%- include("protectedFieldset.ejs") _%>
  <%- include("formActions.ejs", {fallbackUrl: "/ingredients", label: locals.edit ? "UPDATE" : "CREATE"}) _%>
</form>
<%- include("multiStateCheckboxScript.ejs") _%>